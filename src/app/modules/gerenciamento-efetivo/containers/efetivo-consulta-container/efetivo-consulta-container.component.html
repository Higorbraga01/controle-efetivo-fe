<section class="l-finor-consulta-container">
  <header>
    <div class="l-finor-consulta-container__header">
      <div class="l-main-grid">
        <div class="col-12 xl-10 xl-offset-1 mb-3">
          <p-breadcrumb
            [model]="_breadcrumbItems"
            [home]="_home"
            styleClass="mt-3"
            (onItemClick)="handleBreadcrumbClick($event)"
          ></p-breadcrumb>
        </div>
    </div>
  </div>
  </header>
  <div class="l-main-grid">
    <p-card styleClass="mt-3 p-reset">
      <p-toolbar styleClass="mb-2">
        <form [formGroup]="form">
          <div class="p-toolbar-group-left">
            <div class="mr-5">
              <p-autoComplete
                field="label"
                [suggestions]="pessoas"
                (onClear)="searchPessoas({})"
                emptyMessage="Pessoa não encontrado"
                (completeMethod)="searchPessoas($event)"
                [dropdown]="true"
                formControlName="nomePessoa"
                [minLength]="3"
                [placeholder]="'Filtrar por Pessoa'"
                pTooltip="Digite o nome"
              >
                <ng-template let-pessoas pTemplate="item">
                  <div class="dropdown-item-container">
                    <span style="font-weight: bolder; font-size: 1.2rem">{{
                      pessoas.label
                    }}</span>
                    <br />
                    <span style="font-size: 1rem">{{ pessoas.title }}</span>
                  </div>
                </ng-template>
              </p-autoComplete>
            </div>
          </div>
        </form>
        <div class="p-toolbar-group-right">
          <button
            style="margin-right: 0.5rem"
            pRipple
            pButton
            class="p-button-sm"
            label="LIMPAR"
            icon="pi pi-replay"
            (click)="onClear()"
          ></button>
          <button
            style="margin-right: 0.5rem"
            pRipple
            pButton
            class="p-button-sm"
            label="FILTRAR"
            icon="pi pi-filter"
            (click)="updateTable({ first: 0, rows: 10 })"
          ></button>
          <button
            [routerLink]="'cadastro'"
            pButton
            pRipple
            class="p-button-sm"
            label="CADASTRAR PESSOA"
            icon="pi pi-plus"
          ></button>
        </div>
      </p-toolbar>

      <p-table
        #tablepessoaInstrutores
        [value]="pessoasList"
        (onLazyLoad)="updateTable($event)"
        [lazy]="true"
        [rowHover]="true"
        [showCurrentPageReport]="true"
        [paginator]="true"
        [loading]="loadingData"
        [showLoader]="false"
        [rows]="10"
        [totalRecords]="totalRecords"
        [rowsPerPageOptions]="[10, 20, 30]"
        currentPageReportTemplate="Mostrando de {first} a {last} de {totalRecords} registros"
        styleClass="p-datatable-gridlines p-datatable-striped  p-datatable-sm-custom"
      >
        <ng-template pTemplate="emptymessage">
          <tr>
            <td [attr.colspan]="8">Nenhum dado encontrado</td>
          </tr>
        </ng-template>

        <ng-template pTemplate="header">
          <tr>
            <th class="p-text-center">Posto / Quadro / Especialidade / Nome</th>
            <th class="p-text-center">Saram / Cpf </th>
            <th class="p-text-center" pSortableColumn="dataNascimento">
              Dt Nasc
              <p-sortIcon field="dataNascimento"></p-sortIcon>
            </th>
            <th class="p-text-center" pSortableColumn="dataIncorporacao">
              Dt Praça
              <p-sortIcon field="dataIncorporacao"></p-sortIcon>
            </th>
            <th class="p-text-center">
              Nr Identidade
            </th>
            <th class="p-text-center">
              Email
            </th>
            <th class="p-text-center">
              Setor
            </th>
            <th class="p-text-center">Ações</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-pessoa>
          <tr>
            <td class="p-text-center">
              <b> 
              {{ pessoa?.posto?.siglaPosto }}
              </b>
              {{ pessoa?.dataBaixa != null ? "R/1" : ""}}
              {{ 
                pessoa?.quadro == null ? " ":
                pessoa?.quadro?.siglaQuadro.includes("QSD") ? pessoa?.quadro?.siglaQuadro+ " "+ pessoa?.especialidade?.siglaEspecialidade.substring(4,7):
                pessoa?.especialidade?.siglaAbreviada == null ? pessoa?.quadro?.siglaQuadro:
                pessoa?.quadro?.siglaQuadro+ " " +pessoa?.especialidade?.siglaAbreviada
              }}
              {{ pessoa?.nomePessoa }} 
              ( <b>{{ pessoa?.nomeGuerra }}</b> )
            </td>
            <td class="p-text-center">
              ( <b>{{ pessoa?.numeroSaram }}</b> )
              {{ pessoa?.numeroCpf?.substring(0,3)+"."+ pessoa?.numeroCpf?.substring(3,6)+"."+ pessoa?.numeroCpf?.substring(6,9)+"-"+ pessoa?.numeroCpf?.substring(9,11) }}
            </td>
            <td class="p-text-center">
              {{ pessoa?.dataNascimento | date: "dd/MM/yyyy" }}
            </td>
            <td class="p-text-center">
              {{
                pessoa?.dataIncorporacao
                  ? (pessoa?.dataIncorporacao | date: "dd/MM/yyyy")
                  : "-"
              }}
            </td>
            <td class="p-text-center">
              {{ pessoa?.numeroIdentidade ? pessoa?.numeroIdentidade+ " ( "+ pessoa?.siglaOrgaoEspedidor +" )" : "-" }}
            </td>
            <td class="p-text-center">
              {{ pessoa?.nomeEmail ? pessoa?.nomeEmail : "-" }}
            </td>
            <td class="p-text-center">
            <!-- <ng-template ngFor let-setor [ngForOf]="pessoa?.setores" let-i="index">             -->
              {{ pessoa?.setores ? pessoa?.setores[0].siglaSetor + (pessoa?.setores?.length != 1 ? " + "+(pessoa?.setores.length - 1): "") : "-"  }}
             <!-- </ng-template> -->
            </td>
            <td class="p-text-center">
              <div class="flex p-jc-center align-items-center">
                <p-splitButton
                  label="Ações"
                  [model]="menuItems"
                  (onDropdownClick)="onDropdownClick($event, pessoa)"
                >
                </p-splitButton>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
          <tr *ngFor="let row of fakeArrayRows">
            <td *ngFor="let col of fakeArrayColumns">
              <p-skeleton> </p-skeleton>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>

  <p-confirmDialog #cd header="Confirmação" icon="pi pi-exclamation-triangle">
    <p-footer>
      <button
        type="button"
        class="p-button-danger"
        pButton
        icon="pi pi-times"
        label="Não"
        (click)="cd.reject()"
      ></button>
      <button
        type="button"
        pButton
        icon="pi pi-check"
        label="Sim"
        (click)="cd.accept()"
      ></button>
    </p-footer>
  </p-confirmDialog>
</section>
